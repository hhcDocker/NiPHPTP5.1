<div class="smart-widget">
    <div class="smart-widget-header">
        {$SUB_TITLE}
    </div>
    <div class="smart-widget-inner">
        <div class="smart-widget-body">
            <form action="" method="post" class="form-horizontal">
                <div class="form-group">
                    <label for="username" class="col-lg-2 control-label">{:lang('membername')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="username" id="username" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="password" class="col-lg-2 control-label">{:lang('password')}</label>
                    <div class="col-lg-10">
                        <input type="password" name="password" id="password" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="not_password" class="col-lg-2 control-label">{:lang('not password')}</label>
                    <div class="col-lg-10">
                        <input type="password" name="not_password" id="not_password" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="email" class="col-lg-2 control-label">{:lang('email')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="email" id="email" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="realname" class="col-lg-2 control-label">{:lang('realname')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="realname" id="realname" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="nickname" class="col-lg-2 control-label">{:lang('nickname')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="nickname" id="nickname" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="portrait" class="col-lg-2 control-label">{:lang('portrait')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="portrait" id="portrait" class="form-control" value="">
                        <button type="button" class="btn btn-success marginTB-xs" id="upload">{:lang('button upload')}</button>
                        <img src="" id="img-portrait" width="100">
                    </div>
                </div>
                <div class="form-group">
                    <label for="gender" class="col-lg-2 control-label">{:lang('gender')}</label>
                    <div class="col-lg-10">
                        <div class="radio inline-block">
                            <div class="custom-radio m-right-xs checked">
                                <input type="radio" id="gender1" name="gender" value="1" checked>
                                <label for="gender1"></label>
                            </div>
                            <div class="inline-block vertical-top">
                                {:lang('sex man')}
                            </div>
                        </div>
                        <div class="radio inline-block">
                            <div class="custom-radio m-right-xs">
                                <input type="radio" id="gender2" name="gender" value="0">
                                <label for="gender2"></label>
                            </div>
                            <div class="inline-block vertical-top">
                                {:lang('sex woman')}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="birthday" class="col-lg-2 control-label">{:lang('birthday')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="birthday" id="birthday" class="form-control" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="province" class="col-lg-2 control-label">{:lang('province')}</label>
                    <div class="col-lg-2">
                        <select name="province" id="province" class="form-control region" data-type="#city">
                            <option value="">{:lang('select province')}</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <select name="city" id="city" class="form-control region" data-type="#area">
                            <option value="">{:lang('select city')}</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <select name="area" id="area" class="form-control">
                            <option value="">{:lang('select area')}</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="address" class="col-lg-2 control-label">{:lang('address')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="address" id="address" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone" class="col-lg-2 control-label">{:lang('phone')}</label>
                    <div class="col-lg-10">
                        <input type="text" name="phone" id="phone" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="status" class="col-lg-2 control-label">{:lang('status')}</label>
                    <div class="col-lg-10">
                        <div class="radio inline-block">
                            <div class="custom-radio m-right-xs checked">
                                <input type="radio" id="status1" name="status" value="1" checked>
                                <label for="status1"></label>
                            </div>
                            <div class="inline-block vertical-top">
                                {:lang('button open')}
                            </div>
                        </div>
                        <div class="radio inline-block">
                            <div class="custom-radio m-right-xs">
                                <input type="radio" id="status2" name="status" value="0">
                                <label for="status2"></label>
                            </div>
                            <div class="inline-block vertical-top">
                                {:lang('button close')}
                            </div>
                        </div>
                    </div>
                </div>
                <li class="form-group">
                    <label for="" class="col-lg-2 control-label">{:lang('memberlevel')}</label>
                    <div class="col-lg-10">
                        <select name="level" id="level" class="form-control">
                            <option value="">{:lang('memberlevel select')}</option>
                        </select>
                    </div>
                </li>

                <div class="form-group">
                    <div class="col-lg-offset-2 col-lg-10">
                        {:token()}
                        <input type="hidden" name="id" id="id" value="">
                        <input type="submit" value="{:lang('button save')}" class="btn btn-info marginTB-xs">
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{css href="__STATIC__library/datetimepicker/css/bootstrap-datetimepicker.min.css" /}
{js href="__STATIC__library/moment/moment.min.js" /}
{js href="__STATIC__library/moment/locale/zh-cn.js" /}
{js href="__STATIC__library/datetimepicker/js/bootstrap-datetimepicker.min.js" /}
<script type="text/javascript">
$(function(){
    $('#birthday').datetimepicker({
        format: 'Y-M-D', viewMode: 'years'
    });
});

var editor_data = {};
$.loading({
    url: request.api.query,
    async: false,
    animation: true,
    data: {
        method: "user.member.find",
        id: "{$Request.param.id}"
    }
}, function(result){
    if (result.code === "SUCCESS") {
        editor_data = result.data;
        eachToInput(editor_data);
    }
});

$.loading({
    url: request.api.query,
    animation: true,
    data: {
        method: "user.member.level",
    }
}, function(result){
    if (result.code !== "SUCCESS") {
        return false;
    }
    var option = eachToOption(result.data, "id", "name", editor_data["level_id"]);
    $("#level").append(option);
});

$.loading({
    url: request.api.query,
    animation: true,
    data: {
        method: "user.member.region",
    }
}, function(result){
    if (result.code !== "SUCCESS") {
        return false;
    }
    var option = eachToOption(result.data, "id", "name", editor_data["province"]);
    $("#province").append(option);
});
$.loading({
    url: request.api.query,
    animation: true,
    data: {
        method: "user.member.region",
        region_id: editor_data["province"],
    }
}, function(result){
    if (result.code !== "SUCCESS") {
        return false;
    }
    var option = eachToOption(result.data, "id", "name", editor_data["city"]);
    $("#city").append(option);
});
$.loading({
    url: request.api.query,
    animation: true,
    data: {
        method: "user.member.region",
        region_id: editor_data["city"],
    }
}, function(result){
    if (result.code !== "SUCCESS") {
        return false;
    }
    var option = eachToOption(result.data, "id", "name", editor_data["area"]);
    $("#area").append(option);
});
$(".region").change(function(){
    var id = $(this).val();
    var type = $(this).attr("data-type");
    if (type == "#city") {
        $("#city option").remove();
        $("#city").append("<option value=''>{:lang('select city')}</option>");
        $("#area option").remove();
        $("#area").append("<option value=''>{:lang('select area')}</option>");
    }
    if (type == "#area") {
        $("#area option").remove();
        $("#area").append("<option value=''>{:lang('select area')}</option>");
    }

    $.loading({
        url: request.api.query,
        animation: true,
        data: {
            method: "user.member.region",
            region_id: id,
        }
    }, function(result){
        if (result.code !== "SUCCESS") {
            return false;
        }
        var option = eachToOption(result.data, "id", "name");
        $(type).append(option);
    });
});

$.uiPopup({
    element: "#upload",
    title:   "上传",
    content: "<form id='uploadForm' enctype='multipart/form-data'><input type='file' name='upload' id='upload-file' /></form>",
    footer:  "<input type='button' class='btn btn-info marginTB-xs upload-btn' value='{:lang('button upload')}' />"
});
$(".upload-btn").click(function(){
    $.upload({
        url: request.api.upload+"?type=portrait",
        file: $("#uploadForm")[0],
    }, function(result){
        var dir = result.data.save_dir + result.data.file_name;
        $("#portrait").val(dir);
        $("#img-portrait").attr("src",  result.data.domain + dir);
        $.uiPopup({}, "hide");
    });
});

$("form").submit(function(){
    var form_data = "method=user.member.editor";
    form_data += "&"+$(this).serialize();
    $.loading({
        url: request.api.settle,
        async: false,
        data: form_data,
    }, function(result){
        handle(result, "admin/user/member.shtml");
    });
    return false;
});
</script>
