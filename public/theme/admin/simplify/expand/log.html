<div class="smart-widget">
    <div class="smart-widget-header">
        {$SITE_DATA.SUB_TITLE}
    </div>
    <div class="smart-widget-inner">
        <div class="smart-widget-body">
            <form action="" method="post" class="form-horizontal">
                <table class="table table-striped" id="dataTable">
                    <thead>
                        <tr>
                            <th width="20%">{:lang('runuser')}</th>
                            <th width="20%">{:lang('runaction')}</th>
                            <th>{:lang('remark')}</th>
                            <th width="20%">{:lang('ip')}</th>
                            <th width="20%">{:lang('runtime')}</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </form>
            <div id="paging">

            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
var page = window.location.hash;
page = page.substr(1, page.length);
$.loading({
    url: request.api.query,
    animation: true,
    data: {
        timestamp: "{:time()}",
        method: "expand.log.query",
        p: page
    }
}, function(result){
    if (result.code !== "SUCCESS") {
        return false;
    }

    var list = "";
    for (var index in result.data.list) {
        list = list + "<tr>";
        list = list + "<td>["+result.data.list[index].role_name+"]"+result.data.list[index].username+"</td>";
        list = list + "<td>["+result.data.list[index].module+"]"+result.data.list[index].title+"</td>";
        list = list + "<td>"+result.data.list[index].remark+"</td>";
        list = list + "<td>"+result.data.list[index].action_ip+"</td>";
        list = list + "<td>"+result.data.list[index].create_time+"</td>";
        list = list + "</tr>";
    }
    $("#dataTable tbody").prepend(list);
    $("#paging").prepend(result.data.page);
});

function paging(_page) {
    $.rewriteUrl("{:url()}#"+_page);
    $.loading({
        url: request.api.query,
        animation: true,
        data: {
            timestamp: "{:time()}",
            method: "expand.log.query",
            p: _page
        }
    }, function(result){
        if (result.code !== "SUCCESS") {
            return false;
        }
        $("#dataTable tbody tr").remove();
        $("#paging ul").remove();

        var list = "";
        for (var index in result.data.list) {
            list = list + "<tr>";
            list = list + "<td>["+result.data.list[index].role_name+"]"+result.data.list[index].username+"</td>";
            list = list + "<td>["+result.data.list[index].module+"]"+result.data.list[index].title+"</td>";
            list = list + "<td>"+result.data.list[index].remark+"</td>";
            list = list + "<td>"+result.data.list[index].action_ip+"</td>";
            list = list + "<td>"+result.data.list[index].create_time+"</td>";
            list = list + "</tr>";
        }
        $("#dataTable tbody").prepend(list);
        $("#paging").prepend(result.data.page);
    });
};
</script>
