<div class="smart-widget">
    <div class="smart-widget-header">
        {$SUB_TITLE}

        <span class="smart-widget-option">
            <a href="{:url('', array('operate' => 'added'))}" class="btn btn-default btn-xs">
                <span class="fa fa-plus"></span>{:lang('button add')}
            </a>
        </span>
    </div>
    <div class="smart-widget-inner">
        <div class="smart-widget-body">
            <form action="" method="post" class="form-horizontal">
                <table class="table table-striped" id="dataTable">
                    <thead>
                        <tr>
                            <th>{:lang('sort')}</th>
                            <th>{:lang('keyword')}</th>
                            <th>{:lang('title')}</th>
                            <th>{:lang('reply')}</th>
                            <th>{:lang('image')}</th>
                            <th>{:lang('status')}</th>
                            <th>{:lang('operation')}</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><input type="submit" value="{:lang('sort')}" class="btn btn-info"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </form>
            <div id="paging">
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
$.loading({
    url: request.api.query,
    animation: true,
    data: {
        method: "keyword.query.wechat",
        type: "{$type}"
    }
}, function(result){
    if (result.return_code !== "SUCCESS") {
        return false;
    }

    var list = "";
    for (var index in result.return_result.list) {
        list = list + "<tr>";
        list = list + "<td><input type='text' name='sort["+result.return_result.list[index].id+"]' class='form-control mini' value='"+result.return_result.list[index].sort+"'></td>";
        list = list + "<td>"+result.return_result.list[index].keyword+"</td>";
        list = list + "<td>"+result.return_result.list[index].title+"</td>";
        list = list + "<td>"+result.return_result.list[index].content+"</td>";
        list = list + "<td><img src='"+result.return_result.list[index].image+"' width='100' /></td>";
        list = list + "<td>"+result.return_result.list[index].status+"</td>";
        list = list + "<td>";
        list = list + "<a href='"+result.return_result.list[index].url.editor+"'><span class='fa fa-edit'></span>{:lang('button editor')}</a>";
        list = list + "<a class='np-btn-remove' data-id='"+result.return_result.list[index].id+"'><span class='fa fa-edit'></span>{:lang('button remove')}</a>";
        list = list + "</td>";
        list = list + "</tr>";
    }
    $("#dataTable tbody").prepend(list);
    $("#paging").prepend(result.return_result.page);
    pagingToAjax();
});

$(document).on("click", "#paging a", function(){
    var page = $.urlParam("p", $(this).attr("url"));
    $.loading({
        url: request.api.query,
        animation: true,
        data: {
            method: "keyword.query.wechat",
            p: page
        }
    }, function(result){
        if (result.return_code !== "SUCCESS") {
            return false;
        }
        $("#dataTable tbody tr").remove();
        $("#paging ul").remove();

        var list = "";
        for (var index in result.return_result.list) {
            list = list + "<tr>";
            list = list + "<td><input type='text' name='sort["+result.return_result.list[index].id+"]' class='form-control mini' value='"+result.return_result.list[index].sort+"'></td>";
            list = list + "<td>"+result.return_result.list[index].keyword+"</td>";
            list = list + "<td>"+result.return_result.list[index].title+"</td>";
            list = list + "<td>"+result.return_result.list[index].content+"</td>";
            list = list + "<td><img src='"+result.return_result.list[index].image+"' width='100' /></td>";
            list = list + "<td>"+result.return_result.list[index].status+"</td>";
            list = list + "<td>";
            list = list + "<a href='"+result.return_result.list[index].url.editor+"'><span class='fa fa-edit'></span>{:lang('button editor')}</a>";
            list = list + "<a class='np-btn-remove' data-id='"+result.return_result.list[index].id+"'><span class='fa fa-edit'></span>{:lang('button remove')}</a>";
            list = list + "</td>";
            list = list + "</tr>";
        }
        $("#dataTable tbody").prepend(list);
        $("#paging").prepend(result.return_result.page);
        pagingToAjax();
    });
});

$("form").submit(function(){
    var form_data = "method=keyword.remove.wechat";
    form_data += "&"+$(this).serialize();
    $.loading({
        url: request.api.settle,
        async: false,
        data: form_data,
    }, function(result){
        handle(result);
    });
    return false;
});

$(document).on("click", ".np-btn-remove", function(){
    var id = $(this).attr("data-id");
    $.loading({
        url: request.api.settle,
        async: false,
        data: {
            method: "keyword.remove.wechat",
            id: id
        },
    }, function(result){
        handle(result, false, false);
        if (result.return_code === "SUCCESS") {
            $.reload();
        }
    });
    return false;
});
</script>